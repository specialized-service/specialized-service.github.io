WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}};try{(function(){define("MediaViewer",MediaViewerFactory);define("FileViewer",MediaViewerFactory);define("core/template-store-singleton",function(){var properties=/^[a-zA-Z0-9.]+$/;return{get:function(name){return properties.test(name)?eval("FileViewer.Templates."+name):null}}});function MediaViewerFactory(){AJS.I18n.keys["cp.footer.expand.minimode"]="Show all files";AJS.I18n.keys["cp.footer.close.minimode"]="Hide all files";AJS.I18n.keys["cp.thumbnail.description"]="View a larger version of {0}";AJS.I18n.keys["cp.expand.thumbnail.minimode"]="Show all files";AJS.I18n.keys["cp.close.thumbnail.minimode"]="Hide all files";AJS.I18n.keys["cp.go.to.prev"]="Go to the previous file";AJS.I18n.keys["cp.go.to.next"]="Go to the next file";AJS.I18n.keys["cp.go.to.prev.page"]="Previous page";AJS.I18n.keys["cp.go.to.next.page"]="Next page";AJS.I18n.keys["cp.close"]="Close";AJS.I18n.keys["cp.download.original"]="Download";AJS.I18n.keys["cp.fit.to.page"]="Fit to page";AJS.I18n.keys["cp.zoom.in"]="Zoom in";AJS.I18n.keys["cp.zoom.out"]="Zoom out";AJS.I18n.keys["cp.enter.presentation.mode"]="Start Presentation";AJS.I18n.keys["cp.exit.presentation.mode"]="Exit Presentation";AJS.I18n.keys["cp.image.load.fail.header"]="Image could not be loaded.";AJS.I18n.keys["cp.image.load.fail"]="Unable to load file from {0}.";AJS.I18n.keys["cp.show.more"]="More";AJS.I18n.keys["cp.edit.file"]="Edit file";AJS.I18n.keys["cp.print.file"]="Print";AJS.I18n.keys["cp.delete.file"]="Delete";AJS.I18n.keys["cp.arrow.left.disabled"]="You\u0027re viewing the least recent file";AJS.I18n.keys["cp.arrow.right.disabled"]="You\u0027re viewing the most recent file";AJS.I18n.keys["cp.password.protected"]="Enter the password to open this file:";AJS.I18n.keys["cp.password.needed"]="Please enter the password to view this file.";AJS.I18n.keys["cp.password.incorrect"]="Invalid password. Please try again.";AJS.I18n.keys["cp.password.input.placeholder"]="Password";AJS.I18n.keys["cp.password.button.ok"]="OK";AJS.I18n.keys["cp.password.fullscreen.title"]="This file is password protected.";AJS.I18n.keys["cp.password.fullscreen.message"]="Due to technical reasons you have to leave presentation mode to enter the password.";AJS.I18n.keys["cp.error.button.download"]="Download";AJS.I18n.keys["cp.error.button.browser"]="Open in browser";AJS.I18n.keys["cp.error.image.missing.header"]="Ouch! We can\u0027t load the image.";AJS.I18n.keys["cp.error.pdf.missing.header"]="Ouch! We can\u0027t load the PDF.";AJS.I18n.keys["cp.error.media.default.header"]="Ouch! We can\u0027t load the media file.";AJS.I18n.keys["cp.error.pdf.password.header"]="Ouch! We can\u0027t show password protected files yet.";AJS.I18n.keys["cp.error.pdf.password.message"]="Try downloading the file to view it.";AJS.I18n.keys["cp.error.pdf.invalid.header"]="Ouch! Looks like this document is broken.";AJS.I18n.keys["cp.error.pdf.invalid.message"]="Try downloading the file to view it.";AJS.I18n.keys["cp.error.pdf.default.header"]="Ouch! Something is wrong with this file.";AJS.I18n.keys["cp.error.pdf.default.message"]="Try downloading the file to view it.";AJS.I18n.keys["cp.error.default.header"]="The file cannot be displayed";AJS.I18n.keys["cp.error.file.not.found"]="The file does not exist";AJS.I18n.keys["cp.error.file.no.viewer"]="Cannot find a viewer for the given file";AJS.I18n.keys["cp.file.converting.message.header"]="Your preview is on its way!";AJS.I18n.keys["cp.file.converting.message.text"]="In a hurry? You can download the original right now";AJS.I18n.keys["cp.unknown.file.type.header"]="We can\u0027t preview this file.";AJS.I18n.keys["cp.unknown.file.type.download.to.view"]="You\u0027ll have to download the file to view it.";AJS.I18n.keys["cp.unknown.file.type.downloadbutton"]="Download";AJS.I18n.keys["cp.unsupported.browser.header"]="Internet Explorer 9 can\u0027t preview this file.";AJS.I18n.keys["cp.unsupported.browser.download.to.view"]="You\u0027ll have to download the file or use a different browser to view it.";AJS.I18n.keys["cp.3d.file.type.toggle.grid"]="Toggle Grid";AJS.I18n.keys["cp.3d.file.type.toggle.camera.type"]="Toggle Camera Type";AJS.I18n.keys["cp.3d.file.type.toggle.light.type"]="Toggle Scene Light";AJS.I18n.keys["cp.3d.file.type.toggle.axis"]="Toggle Axis";AJS.I18n.keys["cp.companion.inline.pre.download.title"]="Edit files on your computer";AJS.I18n.keys["cp.companion.inline.pre.download.body"]="Download the \u003ca href=\u0022{0}\u0022 target=\u0022_blank\u0022\u003eAtlassian Companion app\u003c/a\u003e to edit this file with a program on your computer, then automatically re-upload it.";AJS.I18n.keys["cp.companion.inline.post.download.title"]="Install and launch the app";AJS.I18n.keys["cp.companion.inline.post.download.body"]="Install and launch the \u003ca href={0} target=\u0022_blank\u0022\u003eCompanion app\u003c/a\u003e, then head back here to edit your first file.";AJS.I18n.keys["cp.companion.inline.post.download.body.problems"]="Problems downloading?";AJS.I18n.keys["cp.companion.inline.post.download.body.try.again"]="Try again for \u003ca href={0} target=\u0022_blank\u0022\u003eMac\u003c/a\u003e or \u003ca href={1} target=\u0022_blank\u0022\u003eWindows\u003c/a\u003e.";AJS.I18n.keys["cp.companion.inline.security.title"]="Let\u0027s keep things secure";AJS.I18n.keys["cp.companion.inline.security.body"]="You need to trust the Companion app to edit files. \u003ca href={0} target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e";AJS.I18n.keys["cp.companion.download.mac"]="Download for Mac";AJS.I18n.keys["cp.companion.download.win"]="Download for Windows";AJS.I18n.keys["cp.companion.download.tooltip"]="You need to be connected to the internet to download the Companion App";AJS.I18n.keys["cp.companion.edit.with.app"]="Edit with {0}";AJS.I18n.keys["cp.companion.downloading"]="Opening file in {0}";AJS.I18n.keys["cp.companion.editingwith"]="Editing with {0}";AJS.I18n.keys["cp.companion.openinapp"]="This file is open in {0}";AJS.I18n.keys["cp.companion.tip"]="Once you save your changes, you\u0027ll be able to upload the file back to {0}.";AJS.I18n.keys["cp.companion.uploadready"]="Ready to upload your changes?";AJS.I18n.keys["cp.companion.savetime.before"]="The file was saved";AJS.I18n.keys["cp.companion.savetime.after"]="in {0}.";AJS.I18n.keys["cp.companion.savetip"]="Either upload the new version, or discard your changes to the file.";AJS.I18n.keys["cp.companion.newversion"]="Update new version";AJS.I18n.keys["cp.companion.waitforupload"]="Waiting for file changes from {0}";AJS.I18n.keys["cp.companion.uploading"]="Uploading new version";AJS.I18n.keys["cp.companion.uploaded.prefix"]="Saved";AJS.I18n.keys["cp.companion.uploading.progress"]="{0} of {1}";AJS.I18n.keys["cp.companion.uploading.progress.done"]="Complete";AJS.I18n.keys["cp.companion.button.discard"]="Discard";AJS.I18n.keys["cp.companion.button.cancel"]="Cancel";AJS.I18n.keys["cp.companion.button.update"]="Upload";AJS.I18n.keys["cp.companion.buttontitle"]="Edit with";AJS.I18n.keys["cp.companion.stillwaiting"]="We are still waiting for file changes, are you sure you want to quit?";AJS.I18n.keys["cp.companion.notification.title"]="New Version of {0} Uploaded";AJS.I18n.keys["cp.companion.notification.body"]="A new version of your file has been uploaded to Confluence";AJS.I18n.keys["cp.companion.launch.wait"]="Waiting for Companion to Launch";AJS.I18n.keys["cp.companion.error.opening.file.title"]="We can\u0027t open your file at the moment";AJS.I18n.keys["cp.companion.error.opening.file.body"]="Check your internet connection and try again, or try downloading the file instead.";AJS.I18n.keys["cp.companion.error.opening.disconnected.body"]="Check your internet connection and make sure the Companion app is running. You can also try refreshing the page.";AJS.I18n.keys["cp.companion.error.uploading.file.title"]="We can\u0027t upload your file at the moment";AJS.I18n.keys["cp.companion.error.uploading.file.body"]="Check your internet connection and \u003ca id={0}\u003etry again\u003c/a\u003e, or save the file on your computer and upload it later.";AJS.I18n.keys["cp.companion.error.uploading.disconnected.body"]="Check your internet connection and make sure the Companion app is running. You can also save the file on your computer and upload it later.";AJS.I18n.keys["cp.companion.error.no.compatible.app.start"]="You don\u0027t have any applications that can open";AJS.I18n.keys["cp.companion.error.no.compatible.app.end"]="files.";AJS.I18n.keys["cp.companion.error.no.compatible.app.generic"]="You don\u0027t have any applications that can open this file type.";AJS.I18n.keys["cp.companion.error.read.only.mode.tooltip"]="{0} is currently in read-only mode. Come back later to upload your file.";AJS.I18n.keys["cp.companion.error.read.only.mode.body"]="{0} is currently in read-only mode. Please try again later.";AJS.I18n.keys["cp.companion.error.file.size.body"]="Your edited file is too big to upload. Files must be less than {0}.";AJS.I18n.keys["cp.companion.upload.comment"]="Uploaded from Companion app";return window.MediaViewer}}());}catch(e){WRMCB(e)};;try{define("confluence/legacy",function(){return Confluence});}catch(e){WRMCB(e)};;try{define("cp/confluence/file-utils",["underscore"],function(b){function e(f){if(f.id&&f.ownerId){return f.ownerId+"-"+f.id}return f.src}function c(f){return b.uniq(f,e)}function d(j,i){var k=a(i,function(l){return b.findWhere(j,{id:l.id})});var h=k[0];var g=k[1];var f=b.map(j,function(l){var m=b.findWhere(h,{id:l.id});return b.extend({},l,m)});return c(f.concat(g))}function a(i,f){var h=function(k){return!k};var j=i.filter(f);var g=i.filter(b.compose(h,f));return[j,g]}return{matchId:e,deDupeFiles:c,mergeFiles:d,partition:a}});}catch(e){WRMCB(e)};;try{define("cp/confluence/async-module-backend",["jquery","ajs"],function(f,b){var a={"pdf-viewer":"wr!com.atlassian.confluence.plugins.confluence-previews:confluence-previews-pdf"};var d="com.atlassian.confluence.plugins.confluence-previews:confluence-previews-pdf-worker";var c=function(h){var g=b.Meta.get("static-resource-url-prefix");return g+"/download/resources/"+d+"/"+h};function e(){var g=new f.Deferred();f.ajax({url:b.contextPath()+"/rest/webResources/1.0/resources",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({r:[d],c:[],xc:[],xr:[]})}).done(function(l){var h;for(var k in l.resources){var j=l.resources[k].url;if(j&&j.indexOf(d)!==-1){h=j;break}}if(h){var m=c("bcmaps/");g.resolve({workerSrc:h,cMapUrl:m})}else{g.reject()}}).fail(g.reject.bind(g));return g.promise()}return function(g){if(a[g]){return WRM.require(a[g])}else{if(g==="pdf-config"){return e()}}}});}catch(e){WRMCB(e)};;try{define("cp/confluence/conversion-poller-backend",["jquery","underscore","ajs"],function(d,c,b){function a(e){this._type=e;if(this._type==="thumbnail"){this._bulkUrl=b.contextPath()+"/rest/documentConversion/0.1/conversion/thumbnail/results";this._singleUrlBase=b.contextPath()+"/rest/documentConversion/0.1/conversion/thumbnail/"}else{this._bulkUrl=b.contextPath()+"/rest/documentConversion/0.1/conversion/convert/results";this._singleUrlBase=b.contextPath()+"/rest/documentConversion/0.1/conversion/convert/"}this._pollers={};this._timerId=0;this._interval=a.INITIAL_INTERVAL;this._debouncedChange=c.debounce(this._change,100)}a.INITIAL_INTERVAL=1000;a.MAX_INTERVAL=10000;a.BACKOFF_PERCENT=1.5;a.prototype.add=function(g,f){if(g&&!this._pollers[g]){var e=d.Deferred();this._pollers[g]={_dfd:e,_version:f};this._debouncedChange()}return this._pollers[g]._dfd.promise()};a.prototype.remove=function(e){var f=this._pollers[e];if(f){f._dfd.reject("cancelled");delete this._pollers[e]}};a.prototype._doPoll=function(){if(this._pollType==="single"){this._pollSingle()}else{if(this._pollType==="multiple"){this._pollMultiple()}}};a.prototype._backoff=function(){var e=this._interval*a.BACKOFF_PERCENT;this._interval=e>a.MAX_INTERVAL?a.MAX_INTERVAL:e;this._timerId=setTimeout(this._change.bind(this),this._interval)};a.prototype._change=function(){var f=this._getAttachmentIds();var e=!(f.length===0);this._cancel();if(!e){delete this._pollType;this._interval=1000}else{this._changeType();this._doPoll()}};a.prototype._changeType=function(){var g=this._getAttachmentIds();var f=g.length===1;var e=g.length>1;if(f&&this._pollType!=="single"){this._pollType="single"}else{if(e&&this._pollType!=="multiple"){this._pollType="multiple"}}};a.prototype._cancel=function(){clearTimeout(this._timerId);this._xhr&&this._xhr.abort();delete this._xhr};a.prototype._getAttachmentIds=function(){return Object.keys(this._pollers)};a.prototype._getIdsAndVersions=function(){var e=this._pollers;return c.map(this._getAttachmentIds(),function(f){return{id:f,v:e[f]._version}})};a.prototype._pollSingle=function(){var f=this._getAttachmentIds()[0];var g=this._pollers[f];var e=g._version;this._xhr=this._getSingle(f,e).always(function(){delete this._xhr}.bind(this)).done(function(i,j,h){if(h.status===202){this._backoff();g._dfd.notify("converting")}else{g._dfd.resolve(this._singleUrlBase+f+"/"+e,h.getResponseHeader("Content-Type"));delete this._pollers[f];this._change()}}.bind(this)).fail(function(h,j,i){if(h.status==429){this._backoff();g._dfd.notify("busy");return}if(i==="abort"){return}g._dfd.reject();delete this._pollers[f];this._change()}.bind(this))};a.prototype._getSingle=function(f,e){return d.ajax(this._singleUrlBase+f+"/"+e,{type:"HEAD",dataType:"json"})};a.prototype._pollMultiple=function(){this._xhr=d.ajax(this._bulkUrl,{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(this._getIdsAndVersions())}).always(function(){delete this._xhr}.bind(this)).done(function(e){c(e).each(function(g,h){var i=this._pollers[h];if(!i){return}if(g==200){var f=i._version;if(this._type!=="thumbnail"){this._getSingle(h,f).done(function(k,l,j){i._dfd.resolve(this._singleUrlBase+h+"/"+f,j.getResponseHeader("Content-Type"));delete this._pollers[h]}.bind(this))}else{i._dfd.resolve(this._singleUrlBase+h+"/"+f,"image/jpg");delete this._pollers[h]}}else{if(g>=400&&g!=429){i._dfd.reject();delete this._pollers[h]}}}.bind(this));this._backoff()}.bind(this))};return a});}catch(e){WRMCB(e)};;try{define("cp/confluence/conversion-poller",["cp/confluence/conversion-poller-backend","jquery"],function(a,e){var b={};var c={};function d(k,g,i,f){if(!b[i]){b[i]=new a(i)}this.backend=b[i];this._attachmentId=k;this._version=g;var h=JSON.stringify({a:k,v:g,t:i});var j=c[h];if(j){this._promise=j.success?e.when(j.url,j.type):e.Deferred().reject(j.reason)}else{this._promise=this.backend.add(this._attachmentId,this._version);this._promise.then(function(l,m){c[h]={success:true,url:l,type:m};return e.Deferred().resolve(l,m)},function(l){if(l!=="cancelled"){c[h]={success:false,reason:l}}},f)}}d.prototype.stop=function(){this.backend.remove(this._attachmentId)};d.prototype.promise=function(){return this._promise};return d});}catch(e){WRMCB(e)};;try{define("cp/service/service-helpers",["ajs"],function(a){var d=["image/jpeg","image/jpg","image/gif","image/png","image/bmp","application/pdf","application/x-pdf"];var b=a.contextPath();var c=function(i){if(i.id===-1){return{}}var o=i.contentType;var n=i.previewContents.THUMBNAIL;var p=i.previewContents.POSTER;var g=i.previewContents.DOCUMENT;var h=i.previewContents.DOCUMENT_HD;var k=i.previewContents.POSTER_HD;var j=a.DarkFeatures.isEnabled("previews.conversion-service");var f=null;var m=null;var l=null;var q=null;var e=null;if(n&&j){f=b+n.downloadUrl}if(p&&j){q=b+p.downloadUrl}if(g&&j&&d.indexOf(o)<0){m=b+g.downloadUrl;o="application/octet-stream"}else{m=b+i.downloadUrl}if(h&&j){l=b+h.downloadUrl}if(k&&j){e=b+k.downloadUrl}return{src:m,src_hd:l,srcDownload:b+i.downloadUrl+"&download=true",type:o,originalContentType:i.contentType,thumbnail:f,poster:q,poster_hd:e,title:i.fileName,name:i.fileName,id:i.id.toString(),ownerId:i.containerId&&i.containerId.toString(),version:i.version,hasReplyPermission:i.hasReplyPermission,hasUploadAttachmentVersionPermission:i.hasUploadAttachmentVersionPermission}};return{responseToFile:c}});}catch(e){WRMCB(e)};;try{define("cp/service/comments-service",["underscore","ajs","jquery"],function(e,c,g){function d(i,j){this.url=c.contextPath()+"/rest/files/1.0/files/"+i+"/comments";this.version=j}var b=function(i,j){return function(k){return c.defaultIfUndefined(k,{rootObject:i,defaultValue:j})}};var f=function(i){var k=b(i,"");var l=b(i,undefined);var j=l("history.createdDate")||new Date();return{id:k("id"),author:{name:k("history.createdBy.displayName"),avatar:k("history.createdBy.profilePicture.path"),profile:c.contextPath()+"/display/~"+k("history.createdBy.username")},comment:k("body.view.value"),editorFormat:k("body.editor.value"),date:j,hasDeletePermission:i.hasDeletePermission,hasEditPermission:i.hasEditPermission,hasReplyPermission:i.hasReplyPermission,hasResolvePermission:i.hasResolvePermission}};var h=function(i){var k=b(i,undefined);var j=b(i,false);return e.extend({pageNumber:k("anchor.page"),position:[k("anchor.x"),k("anchor.y")],resolved:j("resolved.value")},f(i))};var a=function(l,j){var k=l.changedAttributes();if(k.hasOwnProperty("resolved")&&j){return{resolved:l.get("resolved")}}var i={parentId:l.get("parentId"),commentBody:l.get("editorFormat")};if(l.get("position")||l.get("pageNumber")){i=e.extend({},i,{anchor:{x:l.get("position")[0],y:l.get("position")[1],page:l.get("pageNumber"),type:"pin"}})}return i};d.prototype._makeUrl=function(i){if(!i){i=""}return this.url+i+(this.version?("?attachmentVersion="+this.version):"")};d.prototype.getAnnotations=function(k){var i=g.Deferred();var j=e.extend({},k);g.ajax({url:this._makeUrl(),type:"GET",data:{limit:j.limit,start:j.start},dataType:"json"}).then(function(l){var m=e.map(l.results,h);i.resolve(m)}).fail(function(l,n,m){i.reject(l,n,m)});return i.promise()};d.prototype.getReplies=function(k){var i=g.Deferred();var j=e.extend({},k);g.ajax({url:this._makeUrl("/"+k.parentId),type:"GET",data:{limit:j.limit,start:j.start},dataType:"json"}).then(function(n){var o=b(n,[]);var l=o("children");var m=e.map(l,f);i.resolve(m)}).fail(function(l,n,m){i.reject(l,n,m)});return i.promise()};d.prototype.save=function(l){var i=g.Deferred();var k=l.get("id")?"PUT":"POST";var j=(k==="PUT")?this._makeUrl("/"+l.get("id")):this._makeUrl();g.ajax({url:j,type:k,data:JSON.stringify(a(l,(k==="PUT"))),dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(m){i.resolve(f(m))}).fail(function(m,o,n){i.reject(m,o,n)});return i.promise()};d.prototype.remove=function(j){var i=g.Deferred();g.ajax({url:this._makeUrl("/"+j.get("id")),type:"DELETE",dataType:"json"}).then(function(){i.resolve()}).fail(function(k,m,l){i.reject(k,m,l)});return i.promise()};return d});}catch(e){WRMCB(e)};;try{define("cp/service/versions-service",["ajs","jquery","underscore","cp/service/service-helpers"],function(a,f,c,g){var b=a.contextPath();var e=function(j,h,i){return f.ajax({url:b+"/rest/files/1.0/files/content/"+j+"/byAttachmentId",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{attachmentId:h,attachmentVersion:i}}).pipe(function(k){return g.responseToFile(k)})};function d(){}d.prototype.getAllFileVersions=function(h){var i=b+"/rest/files/1.0/files/"+h+"/versions";return f.ajax(i).pipe(function(k){var j=k.results;return c.sortBy(c.map(j,function(l){return{id:l.id,version:l.version.number,message:l.version.message,countComments:l.countComments,ownerId:l.ownerId}}),function(l){return 0-l.version})})};d.prototype.getFileVersion=function(j,h,i){return e(j,h,i)};return d});}catch(e){WRMCB(e)};;try{define("cp/service/files-service",["ajs","jquery","underscore","cp/service/service-helpers"],function(a,e,c,f){var b=a.contextPath();function d(g){this.url=b+"/rest/files/1.0/files/content/"+g}d.prototype.getFiles=function(i){var g=e.Deferred();var h=c.extend({},i);e.ajax({url:this.url,type:"GET",data:{"max-results":h.limit,"start-index":h.start},dataType:"json"}).then(function(k){var j=c.map(k.results,f.responseToFile);g.resolve(j)}).fail(function(j,l,k){g.reject(j,l,k)});return g.promise()};d.prototype.getFilesWithId=function(h){var g=e.Deferred();e.ajax({url:this.url+"/byAttachmentIds",type:"POST",data:JSON.stringify({attachmentIds:h}),dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(j){var i=c.map(j.results,f.responseToFile);g.resolve(i)}).fail(function(i,k,j){g.reject(i,k,j)});return g.promise()};d.prototype.getFileWithId=function(g){return this.getFilesWithId([g]).pipe(function(h){return h[0]})};d.prototype.getFilesWithoutId=function(h){var g=e.Deferred();e.ajax({url:this.url+"/minusAttachmentIds",type:"POST",data:JSON.stringify({attachmentIds:h}),dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(j){var i=c.map(j.results,f.responseToFile);g.resolve(i)}).fail(function(i,k,j){g.reject(i,k,j)});return g.promise()};return d});}catch(e){WRMCB(e)};;try{define("cp/confluence/file-preview-loader",["jquery","underscore","ajs","cp/confluence/preview-support","cp/confluence/async-module-backend","MediaViewer","cp/confluence/conversion-poller","cp/service/files-service","cp/service/comments-service","cp/service/versions-service","cp/confluence/file-utils","confluence/api/event"],function(o,I,g,F,H,z,l,a,i,D,y,G){var u,e,b=false;var s=function(K,L){g.trigger("analyticsEvent",{name:K,data:L})};var p=z.require("file-types/file-types");function B(K){return K.attr("data-image-src")||K.attr("data-file-src")||K.attr("src")||K.attr("href")}function v(K){return K.attr("data-linked-resource-content-type")||K.attr("data-mime-type")||"image/web"}function m(L){var K=o(L);var M=B(K);var N=K.attr("data-linked-resource-default-alias");return{src:M,srcDownload:M+"&download=true",thumbnail:M,type:v(K),title:N||M,name:N,id:K.attr("data-linked-resource-id"),version:K.attr("data-linked-resource-version"),ownerId:K.attr("data-linked-resource-container-id"),isRemoteLink:K.hasClass("confluence-external-resource")}}function q(K){return I.map(K,function(L){return m(L)})}function J(K){if(z.isPluginEnabled("annotation")){K.once("fv.showFile",function(){z.getPlugin("annotation").showAnnotationsPanel(K)})}}function t(K,M,L,O){var N;if(u&&b&&e===L){n(K,L,true);N=o.when()}else{u&&u.close();N=E(L);b=true}N.then(function(){if(!M){return}var Q=o(M);var T=Q.attr("data-linked-resource-id"),P=Q.attr("data-linked-resource-container-id"),S=Q.attr("data-image-src")||Q.attr("data-file-src")||Q.attr("src");var R=(T&&P)?{id:T,ownerId:P}:{src:S};u.open(R,"main");if(O){J(u)}})}var k={showPreviewerForComment:function(O,P,N,R){var K=o(O);var Q=P.find(F.getFileSelectorString());var M=I.uniq(Q,function(S){return S.src||S.href});var L=q(M);k.setupPreviewerForComment(L,N,false).then(function(){var V=K.attr("data-linked-resource-id"),S=K.attr("data-linked-resource-container-id"),U=K.attr("data-image-src")||K.attr("data-file-src")||K.attr("src");var T=(V&&S)?{id:V,ownerId:S}:{src:U};u.open(T,"comments");if(R){J(u)}})},setupPreviewerForComment:function(L,M,O){var N=o.when();var K=g.Meta.get("page-id");if(K){N=x(L,K,false)}n(L,M,O);N.then(function(P){u.updateFiles(P,y.matchId)});return N}};function C(M,L,N){var K=j(M,L);K.open({id:K.getFiles()[0].id},N)}function j(L,K){var M=I.isArray(L)?L:q(o(L));n(M,K,false);return u}var f;var c=function(L){var N=o.Deferred();var M={};var K={src_hd:null,poster_hd:null};if(L.get("src_hd")){o.ajax({type:"HEAD",async:true,url:L.get("src_hd")}).then(function(O,Q,P){N.resolve(P.status!==200?K:M)},function(O,Q,P){N.resolve(K)})}else{N.resolve(M)}return N.promise()};var w=function(L){var K=new o.Deferred();K.resolve({src:L.get("src"),srcDownload:L.get("srcDownload")});return K.promise()};var r=function(M){f&&f.stop();var N=M.get("id");var L=M.get("version");var K=o.Deferred();if(!N){return o.when(true,M.get("src"),M.get("type"))}f=new l(N,L,"conversion",function(O){if(O==="converting"||O==="busy"){K.resolve(false,M.get("src"),M.get("type"))}});f.promise().then(function(P,O){if(K.state()!=="pending"){return}c(M).done(function(Q){K.resolve(true,P,O,Q)}).fail(function(){K.resolve(true,P,O)})}).fail(function(O){if(K.state()!=="pending"){return}if(O==="cancelled"){K.reject(O)}else{c(M).done(function(P){K.resolve(true,M.get("src"),M.get("type"),P)}).fail(function(){K.resolve(true,M.get("src"),M.get("type"))})}});return K.promise()};var A=function(M){f&&f.stop();var N=M.get("id");var L=M.get("version");var K=o.Deferred();f=new l(N,L,"conversion");f.promise().done(function(P,O){K.resolve(P,O)}).fail(function(O){if(O!=="cancelled"){K.resolve(M.get("src"),M.get("type"))}else{K.reject(O)}});return K.promise()};var d=function(N){var Q=N.get("type"),L=N.get("src"),M=N.get("id"),R=N.get("isRemoteLink"),T=o.Deferred();var P=g.DarkFeatures.isEnabled("previews.dcl-image-thumbnails");if((!P&&!R&&p.isImageBrowserSupported(Q))){var K=L.replace("/attachments/","/thumbnails/");T.resolve(K,"image/jpeg")}else{if(M){var O=N.get("version");var S=new l(M,O,"thumbnail");S.promise().done(function(V,U){T.resolve(V,U)}).fail(function(){T.reject()})}else{T.resolve(L,Q)}}return T.promise()};function h(N,L){e=L;var M=g.Meta.get("static-resource-url-prefix");var K="com.atlassian.confluence.plugins.confluence-previews:mediaviewer-chunks";var O=M+"/download/resources/"+K+"/";var Q={appendTo:o("body"),files:N,filesService:a,commentService:i,versionsService:D,moduleBackend:H,enableAnnotations:g.DarkFeatures.isEnabled("file-annotations"),enablePermalinks:g.DarkFeatures.isEnabled("previews.sharing"),enableMiniMode:true,enableShareButton:true,enableVersionNavigation:true,viewers:["image","document","video"],analyticsBackend:s,assets:{basePath:O},i18n:g.I18n.keys,fetchToken:w};if(L===F.VIEW_MODE.SIMPLE){Q.enableAnnotations=false;Q.enableMiniMode=false;Q.enableShareButton=false;Q.enableVersionNavigation=false}if(g.DarkFeatures.isEnabled("previews.conversion-service")){Q.isPreviewGenerated=r;Q.generatePreview=A;Q.generateThumbnail=d}u=new z(Q);u.on("fv.showFile",function(){G.trigger("confluence-previews.fileviewer.completed")});var P=u.getView();P.show=I.compose(P.show,function(R){g.trigger("remove-bindings.keyboardshortcuts");return R});P.hide=I.compose(P.hide,function(R){g.trigger("add-bindings.keyboardshortcuts");return R});return u}function n(M,K,L){if(!u||e!==K){u&&u.close();h(M,K)}u.updateFiles(y.deDupeFiles(M),y.matchId);if(z.isPluginEnabled("permalink")){z.getPlugin("permalink").setRoutingEnabled(L)}}function E(N){var M=I.uniq(o(F.getFileSelectorString()),function(Q){return o(Q).attr("data-linked-resource-id")||Q.src});var L=q(M);var P=g.Meta.get("user-timezone-offset");if(!P){g.Meta.set("user-timezone-offset",0)}var O;var K=g.Meta.get("page-id");if(K){O=x(L,K,true)}else{O=o.when()}return O.then(function(Q){n(Q,N,true);if(z.isPluginEnabled("permalink")){z.getPlugin("permalink").startRouting()}})}function x(M,L,Q){var O=I.filter(M,function(S){return!!S.id}),P=I.pluck(O,"id"),R=L,K=new a(R);var N=[];if(P.length){N.push(K.getFilesWithId(P));if(Q){N.push(K.getFilesWithoutId(P))}}else{N.push(K.getFiles())}return o.when.apply(o,N).pipe(function(){var U=I.reduce(arguments,function(X,W){return X.concat(W)});var V=g.DarkFeatures.isEnabled("previews.trigger-all-file-types");var T=g.DarkFeatures.isEnabled("previews.conversion-service");var S=U;if(!V&&!T){S=I.filter(U,function(W){return p.isImage(W.type)||(p.isPDF(W.type)&&F.isPDFSupported())})}return y.mergeFiles(M,S)})}return{showPreviewer:t,showPreviewerForSingleFile:C,setupPreviewForSingleFile:j,showPreviewerForComment:k.showPreviewerForComment}});}catch(e){WRMCB(e)};